
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bet Logger - Screenshot Upload</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0d0d0d;
            color: white;
            text-align: center;
            padding: 50px;
        }
        #drop-area {
            border: 2px dashed #ccc;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            margin: auto;
            padding: 30px;
            background: #1a1a1a;
        }
        #drop-area.highlight {
            border-color: limegreen;
        }
        input[type="file"] {
            display: none;
        }
        .btn {
            background-color: limegreen;
            color: black;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }
        .results {
            margin-top: 30px;
            text-align: left;
            white-space: pre-wrap;
            background: #333;
            padding: 15px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <h1>Bet Logger</h1>
    <p>Drag and drop your bet screenshot here</p>
    <div id="drop-area">
        <form class="my-form">
            <input type="file" id="fileElem" accept="image/*" onchange="handleFiles(this.files)">
            <label class="btn" for="fileElem">Upload Screenshot</label>
        </form>
    </div>
    <div class="results" id="output"></div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
    <script>
        let dropArea = document.getElementById('drop-area');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            let dt = e.dataTransfer;
            let files = dt.files;
            handleFiles(files);
        }

        
function parseBetText(text) {
    const lines = text.toLowerCase().split(/\n+/).map(l => l.trim()).filter(l => l);

    let stake = null, toWin = null, odds = null, bet = null;

    // Parse stake and to win
    for (let line of lines) {
        if (line.includes("risk") || line.includes("stake")) {
            const match = line.match(/\$?(\d+\.\d+|\d+)/);
            if (match) stake = parseFloat(match[1]);
        }
        if (line.includes("to win")) {
            const match = line.match(/\$?(\d+\.\d+|\d+)/);
            if (match) toWin = parseFloat(match[1]);
        }
    }

    // Parse odds
    const oddsMatch = text.match(/([+-]\d{{3,5}})/);
    if (oddsMatch) odds = parseInt(oddsMatch[1]);

    // Get the first capitalized team/player line as bet
    bet = lines.find(line => line.match(/[a-z]+ [+-]?\d+@?-?\d*/));

    return {
        sport: "",  // left blank for now
        team: "",
        bet_type: "",
        bet: bet || "",
        stake: stake || "",
        to_win: toWin || "",
        odds: odds || "",
        book: "",
        game: "",
        raw_text: text
    };
}


function handleFiles(files) {
            [...files].forEach(file => {
                const reader = new FileReader();
                reader.onload = () => {
                    Tesseract.recognize(
                        reader.result,
                        'eng',
                        { logger: m => console.log(m) }
                    ).then(({
                        data: { text }
                    }) => {
                        document.getElementById('output').textContent = text;

                        const payload = {
                            sport: "",
                            team: "",
                            bet_type: "",
                            bet: "",
                            stake: "",
                            to_win: "",
                            odds: "",
                            book: "",
                            game: "",
                            raw_text: text
                        };

                        fetch("https://script.google.com/macros/s/AKfycbxtj7I9NhIOTGp8VGcjJUQpwqf7A3fYYSmdGanWhOM_8KluuJkMjUJiPoCiwGX06Zz8/exec", {
                            method: "POST",
                            body: JSON.stringify(payload),
                            headers: {
                                "Content-Type": "application/json"
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('output').textContent += "\n\n" + JSON.stringify(data, null, 2);
                        })
                        .catch(error => {
                            document.getElementById('output').textContent += "\n\nError: " + error;
                        });
                    });
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
